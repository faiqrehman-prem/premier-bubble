!function(){"use strict";if(window.NovaAgentLoaderExecuted)return;window.NovaAgentLoaderExecuted=!0;const o=window.NOVA_AGENT_URL||window.location.origin;async function t(){try{console.log("🚀 Nova Agent: Starting domain validation...");const n=await async function(){try{console.log("🔍 Nova Agent: Checking domain authorization...");const t=function(){const o={"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest","X-Nova-Agent":"widget-loader"};return o["X-Origin-Domain"]=window.location.hostname,o}(),n=function(){const o=window.location.hostname,t=window.location.origin,n=document.referrer;if(!/^[a-zA-Z0-9.-]+$/.test(o))throw new Error("Invalid domain format");if(!/^https?:\/\/[a-zA-Z0-9.-]+(:[0-9]+)?$/.test(t))throw new Error("Invalid origin format");return{domain:o,origin:t,referer:n||""}}(),i=await fetch(o+"/api/validate-domain",{method:"POST",headers:t,body:JSON.stringify(n),credentials:"same-origin",cache:"no-cache",referrerPolicy:"strict-origin-when-cross-origin"});if(!i.ok)throw new Error(`Domain validation failed: ${i.status}`);const e=i.headers.get("content-type");if(!e||!e.includes("application/json"))throw new Error("Invalid response format");const r=await i.json();if("object"!=typeof r||null===r)throw new Error("Invalid response structure");return r}catch(o){return console.warn("Nova Agent: Domain authorization check failed:",o.message),{authorized:!1}}}();n.authorized&&n.widgetScript?(console.log("✅ Nova Agent: Domain authorized, loading widget..."),await(t=n.widgetScript,new Promise((n,i)=>{if(!t)return void i(new Error("No widget script provided"));window.NOVA_AGENT_PRE_AUTHORIZED=!0;const e=document.createElement("script");e.src=o+t,e.async=!0,e.defer=!0,e.onload=()=>{console.log("✅ Nova Agent: Widget script loaded successfully"),n()},e.onerror=()=>{console.error("❌ Nova Agent: Failed to load widget script"),i(new Error("Failed to load widget script"))},document.head.appendChild(e)}))):(console.log("🚫 Nova Agent: Domain not authorized"),console.warn("🚫 Nova Agent: Domain not authorized. Contact the site administrator."),window.confirm&&setTimeout(()=>{alert("Nova Voice Agent is not authorized for this domain. Contact the site administrator.")},2e3))}catch(o){console.error("💥 Nova Agent: Initialization error:",o)}var t}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",t):t(),window.addEventListener("resize",function(){})}();